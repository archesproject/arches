{% load i18n %}
<!-- ko if: !configForm  && state=== 'form' -->
<div class="row widget-wrapper">
    <label class="control-label widget-input-label" for="" data-bind="text:label"></label>

    <div id='map' class="map-crud-container relative" data-bind="mapboxgl: { mapOptions: {
          style: mapStyle,
          zoom: zoom,
          centerX: centerX,
          centerY: centerY,
          pitch: pitch,
          bearing: bearing
      }, afterRender: function(){setupMap(map)} }">
        <!-- Geocode Panel -->
        <div class="geocode-container" data-bind="css : {'geocode-container-shim' : mapToolsExpanded}">
            <select data-bind="ajaxchosen: {
              ajaxChosenOptions:{
                loadingImg: '{{ STATIC_URL }}img/select2-spinner.gif',
                minLength: 3,
                processItems: function(data){return _.map(data.results, function(res, i) {return {text: res.id, id:i}})}
              },
              chosenOptions: {
                width: '100%'
              },
              ajaxOptions: {
                url: geocodeUrl,
                type: 'GET',
                success: function(data, textStatus, jqXHR){ geocodeResponseOptions(data.results);},
                data: [{name:'geocoder', value:geocoder}]},
              value: geocodePoint}">
            </select>
        </div>

        <!-- Map Tools Panel -->
        <div id="map-widget-container relative" class="">
            <div class="text-center map-widget-container" data-bind="css : {'map-widget-container-expanded' : mapToolsExpanded}">
                <a id="map-tools" href="" class="" style="display: inline;" data-bind="click: toggleMapTools"><i class="ion-ios-gear add-tooltip" data-bind="tooltip: { title: '{% trans "Map Controls" %}', placement: 'bottom' }"></i></a>
            </div>

            <div id="map-widget-toolbar" class="map-widget-toolbar relative" data-bind="fadeVisible: mapToolsExpanded, delay:200, fade:400">
                <div class="map-widget-tool text-center" data-bind="click: function(){toggleMapControlPanels('basemaps')}, css : {'active': !mapControlPanels.basemaps()}">
                    <a id="" href="" class="map-widget-icon"><i class="ion-map add-tooltip" data-bind="tooltip: { title: '{% trans "Basemaps" %}', placement: 'bottom' }"></i></a>
                </div>
                <div id="btn-overlays" class="map-widget-tool text-center" data-bind="click: function(){toggleMapControlPanels('overlays')}, css : { 'active': !mapControlPanels.overlays()}">
                    <a id="overlays" href="" class="map-widget-icon"><i class="ion-navicon add-tooltip" data-bind="tooltip: { title: '{% trans "Overlays" %}', placement: 'bottom' }"></i></a>
                </div>
                <div class="map-widget-tool text-center" data-bind="click: function(){toggleMapControlPanels('maptools')}, css : {'active': !mapControlPanels.maptools()}">
                    <a id="" href="" class="map-widget-icon"><i class="ion-crop add-tooltip" data-bind="tooltip: { title: '{% trans "Map Tools" %}', placement: 'bottom' }"></i></a>
                </div>
                <div class="map-widget-tool text-center" data-bind="click: function(){toggleMapControlPanels('legend')}, css : {'active': !mapControlPanels.legend()}">
                    <a id="" href="" class="map-widget-icon"><i class="ion-ios-list add-tooltip" data-bind="tooltip: { title: '{% trans "Legend" %}', placement: 'bottom' }"></i></a>
                </div>
                <div class="map-widget-tool text-center" data-bind="click: function(){toggleMapControlPanels('basemaps')}, css : {'map-widget-tool-expanded' : mapToolsExpanded}">
                    <a id="close-map-tools" href="#" class="map-widget-icon" data-bind="click: toggleMapTools"><i class="ion-ios-close add-tooltip" data-bind="tooltip: { title: '{% trans "Close" %}', placement: 'bottom' }"></i></a>
                </div>
            </div>

            <!-- Basemaps -->
            <div id="map-widget-basemaps" class="panel map-widget-panel" data-bind="fadeVisible: mapToolsExpanded, delay:200, fade:400, css : {'map-panel-inactive': mapControlPanels.basemaps}">
                <!-- Panel Title -->
                <div class="map-widget-panel-title">
                    <h4 class=""> Basemaps </h4>
                </div>

                <!-- ko foreach: { data: [$data], as: 'self' } -->

                <!-- ko foreach: basemaps -->
                <div class="map-widget-overlay-item relative" data-bind="click: self.selectBasemap">
                    <div class="map-overlay-vis-toogle text-center">
                        <!-- ko if: name === self.basemap()-->
                        <i class="ion-checkmark-circled"></i>
                        <!-- /ko -->
                        <!-- ko if: name !== self.basemap() -->
                        <i class="ion-checkmark-circled fade"></i>
                        <!-- /ko -->
                    </div>
                    <div class="map-overlay-name">
                        <a id="" class="" href=""><span data-bind='text: name'><span></a>
                    </div>
                </div>
                <!-- /ko -->
                <!-- /ko -->
            </div>
        </div>

        <!-- Overlays -->
        <div id="overlays-panel" class="panel map-widget-panel" data-bind="css: {'map-panel-inactive': mapControlPanels.overlays}">
            <!-- Panel Title -->
            <div class="map-widget-panel-title">
                <h4 class=""> Overlays <i class="ion-ios-plus pull-right add-tooltip" data-placement="left" data-toggle="tooltip" data-original-title="add overlay"></i></h4>
            </div>

            <div data-bind="sortable: overlays">
                <div class="map-widget-overlay-item relative" data-bind="css:{'show-tools': showingTools}">
                    <div class="map-overlay-vis-toogle text-center" data-bind="css: {'overlay-invisible':invisible}, click: toggleOverlayVisibility">
                        <i data-bind="css: icon"></i>
                    </div>
                    <div class="map-overlay-name">
                        <a class="" href=""><span data-bind="text:name"><span></a>
                    </div>
                    <div class="map-overlay-item-tools">
                        <a href="#" class="overlay-toggle" data-bind="click: toggleOverlayTools">
                            <!-- ko if: showingTools() === false  -->
                            <i class="ion-arrow-left-b" data-bind="showingTools()"></i>
                            <!-- /ko -->
                            <!-- ko if: showingTools() !== false  -->
                            <i class="ion-arrow-down-b"></i>
                            <!-- /ko -->
                        </a>
                    </div>
                    <div class="map-overlay-item-tools-panel" data-bind="fadeVisible: showingTools, delay:300, fade: 200">

                        <!-- <div class="row"> -->

                        <!-- <div class="col-xs-8"> -->
                        <div class="overlay-slider">
                            <div data-bind="noUiSlider: {
                                start: opacity,
                                range: {
                                  'min': 0,
                                  'max': 100
                                },
                                connect: 'lower'
                            }"></div>
                        </div>
                        <!-- </div> -->

                        <!-- <div class="col-xs-4"> -->
                        <div class="overlay-tool-group">
                            <i class="ion-information-circled pull-right overlay-tool-icon add-tooltip" data-placement="left" data-toggle="tooltip" data-original-title="visible: 7-20"></i>
                            <a href="#" data-bind="click: function () { $parent.moveOverlay($data, 'up') }">
                                <i class="ion-ios-arrow-up pull-right overlay-tool-icon add-tooltip" data-placement="bottom" data-toggle="tooltip" data-original-title="move overlay up"></i>
                            </a>
                            <a href="#" data-bind="click: function () { $parent.moveOverlay($data, 'down') }">
                                <i class="ion-ios-arrow-down pull-right overlay-tool-icon add-tooltip" data-placement="bottom" data-toggle="tooltip" data-original-title="move overlay down"></i>
                            </a>
                        </div>
                        <!-- </div> -->

                        <!-- </div> -->

                    </div>
                </div>
            </div>

        </div>

        <!-- Map Tools -->
        <div id="maptools-panel" class="panel map-widget-panel" data-bind="css: {'map-panel-inactive': mapControlPanels.maptools}">
            <!-- Panel Title -->
            <div class="map-widget-panel-title">
                <h4 class=""> Map Tools </h4>
            </div>

            <!-- ko foreach: { data: [$data], as: 'self' } -->

            <!-- ko foreach: geometryTypes -->
            <div class="map-widget-overlay-item relative editing-tool" data-bind="click: self.selectEditingTool">
                <div class="map-overlay-vis-toogle text-center">
                    <i data-bind="css: self.editingToolIcons[$data]"></i>
                </div>
                <div class="map-overlay-name">
                    <a id="" class="" href=""><span data-bind='text: $data'><span></a>
                </div>
            </div>
            <!-- /ko -->
            <!-- /ko -->
            <div class="map-widget-overlay-item relative editing-tool" data-bind="click: selectEditingTool">
                <div class="map-overlay-vis-toogle text-center">
                    <i data-bind="css: editingToolIcons.Delete"></i>
                </div>
                <div class="map-overlay-name">
                    <a id="" class="" href=""><span>Delete<span></a>
                </div>
            </div>

        </div>

        <!-- Legend -->
        <div id="legend-panel" class="panel map-widget-panel" data-bind="css: {'map-panel-inactive': mapControlPanels.legend}">
            <!-- Panel Title -->
            <div class="map-widget-panel-title">
                <h4 class=""> Legend </h4>
            </div>
            <div class="map-widget-panel-title legend-subtitle">
                <h5 class=""> Overlays </h5>
            </div>
            <div data-bind="sortable: overlays">
              <div class="map-widget-overlay-item relative">
                  <div class="map-overlay-vis-toogle text-center">
                      <i data-bind="css: icon, style: {color:color}"></i>
                  </div>
                  <div class="map-overlay-name">
                      <a class="" href=""><span data-bind="text:name"><span></a>
                  </div>
              </div>
            </div>

            <div class="map-widget-panel-title legend-subtitle">
                <h5 class=""> Basemaps </h5>
            </div>
            <!-- ko foreach: { data: [$data], as: 'self' } -->
            <!-- ko foreach: basemaps -->
            <div class="map-widget-overlay-item relative">
                <div class="map-overlay-vis-toogle text-center map-thumbnail">
                    <img height="40px" data-bind="attr: { src: '{{ STATIC_URL }}img/map-thumbnails/' + name + '.png'}" ></img>
                </div>
                <div class="map-overlay-name">
                    <a id="" class="" href=""><span data-bind='text: name'><span></a>
                </div>
            </div>
            <!-- /ko -->
            <!-- /ko -->

        </div>
    </div>


    <!-- Overlay Selector -->
    <div class="overlay-container" style="display: none;">
        <h3 class="panel-title card-main-title"> Overlays <i class="pull-right icon-xl ion ion-ios-close-empty"></i></h3>

        <!-- Overlay Listing -->
        <div id="report-image-grid" class="report-image-grid">


        </div>

    </div>
</div>
<!-- /ko -->

<!-- ko if: !configForm  && state=== 'report' -->
<dt data-bind="text: label"></dt>
<dd data-bind="text: value() || '{% trans " None " %}'"></dd>
<!-- /ko -->

<!-- ko if: configForm -->
<div class="control-label">
    {% trans "Zoom Level" %}
</div>
<div class="col-xs-12 pad-no crud-widget-container">
    <input type="number" min=1 max=20 id="" placeholder="{% trans " Zoom Level " %}" class="form-control input-md widget-input" data-bind="value: zoom, valueUpdate: 'keyup'">
</div>
<div class="control-label">
    {% trans "Default Geocoder" %}
</div>
<div class="col-xs-12 pad-no crud-widget-container">
    <select type="" id="" placeholder="{% trans " Geocoder " %}" data-bind="options:geocoderOptions, optionsText:'name', optionsValue:'id', event: {change: onGeocodeSelection}, value: geocoder, chosen: {width: '100%'}"></select>
</div>
<div class="control-label">
    {% trans "Map Center Longitude" %}
</div>
<div class="col-xs-12 pad-no crud-widget-container">
    <input type="number" id="" placeholder="{% trans " Longitude (x coordinate) " %}" class="form-control input-md widget-input" data-bind="value: centerX, valueUpdate: 'keyup'">
</div>
<div class="control-label">
    {% trans "Map Center Latitude" %}
</div>
<div class="col-xs-12 pad-no crud-widget-container">
    <input type="number" id="" placeholder="{% trans " Longitude (x coordinate) " %}" class="form-control input-md widget-input" data-bind="value: centerY, valueUpdate: 'keyup'">
</div>
<div class="control-label">
    {% trans "Pitch" %}
</div>
<div class="col-xs-12 pad-no crud-widget-container">
    <input type="number" id="" placeholder="{% trans " Pitch (Degrees) " %}" class="form-control input-md widget-input" data-bind="value: pitch, valueUpdate: 'keyup'">
</div>
<div class="control-label">
    {% trans "Bearing" %}
</div>
<div class="col-xs-12 pad-no crud-widget-container">
    <input type="number" id="" placeholder="{% trans " Bearing (Degrees) " %}" class="form-control input-md widget-input" data-bind="value: bearing, valueUpdate: 'keyup'">
</div>
<!-- /ko -->
