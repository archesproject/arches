{% extends "views/forms/widgets/base.htm" %} {% load i18n %} {% block form %}
<div class="row widget-wrapper" data-bind="css: {'report-header': reportHeader}">
    <label class="control-label widget-input-label" for="" data-bind="text:label"></label>

    <div id='map' class="map-crud-container expanded-map relative" data-bind="mapboxgl: { mapOptions: {
          style: mapStyle,
          zoom: zoom,
          minZoom: minZoom,
          maxZoom: maxZoom,
          centerX: centerX,
          centerY: centerY,
          pitch: pitch,
          bearing: bearing
       }, afterRender: function(){setupMap(map)} }">

        <!--ko if: drawMode -->
        <div class="geometry-editing-notifications">
            <div class="alert-wrap in animated jellyIn">
                <div class="alert alert-warning" role="alert">
                    <button class="close" type="button">
                   </button>
                    <div class="media">
                        <!-- ko if: drawMode() === 'draw_point'  -->
                        <strong>Edit Mode</strong> You are creating points. Click the Point tool to exit.
                        <!-- /ko -->
                        <!-- ko if: drawMode() === 'draw_polygon'-->
                        <strong>Edit Mode</strong> You are creating polygons. Click the Polygon tool to exit.
                        <!-- /ko -->
                        <!-- ko if: drawMode() === 'draw_line_string'-->
                        <strong>Edit Mode</strong> You are creating lines. Click the Line tool to exit.
                        <!-- /ko -->
                        <!-- ko if: drawMode() === 'simple_select'-->
                        <strong>Edit Mode</strong> You are editing a <span data-bind="text: selectedFeatureType"></span>.
                        <!-- ko if: selectedFeatureType() !== 'point'-->
                        <span>Click and drag to move.</span>
                        <!-- /ko -->
                        <!-- ko if: selectedFeatureType() !== 'point'-->
                        <span>Click and drag to move, or click it again to edit verticies.</span>
                        <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko if: drawMode() === 'direct_select'-->
                        <strong>Edit Mode</strong> You are editing <span data-bind="text: selectedFeatureType"></span> verticies. Click outside the feature to exit.
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>
        <!-- /ko -->
        <div class="overlay-selection-container" data-bind="css : {'selector-closed': overlaySelectorClosed}">
          <div data-bind="with: overlayLibraryList">
           <!-- Title -->
           <div class="overlay-title">
               Map Overlay Library
               <span class="pull-right"><i class="overlay-close ion-ios-close" data-bind="click: $parent.toggleOverlaySelector.bind($parent)"></i></span>
           </div>
           <!-- Filter -->
           <div class="overlay-filter-container">
               <div class="list-filter">
                   <input type="text" class="form-control overlay-filter" style="" placeholder="{% trans "Find an Overlay" %}" data-bind="value: $data.filter, valueUpdate: 'afterkeydown'">
                   <span class="clear-node-search" data-bind="click: $data.clearSearch"><i class="fa fa-times-circle"></i></span>
               </div>
           </div>

           <div class="overlay-list-container">
                <div id="overlay-grid" class="grid" style="position: relative;" data-bind="foreach: {data: items}">
                     <div class="overlay-card" style="" data-bind="click: $parents[1].exchangeOverlay, css: {'selected': checkedOutOfLibrary}, visible: $data.filtered() == false">
                         <div class="overlay-card-item">
                             <div class="overlay-card-vis-toggle">
                                 <i class="ion-checkmark-circled"></i>
                             </div>
                             <div class="overlay-card-main" style="">
                                 <a id="" class="" style="" href="#"><span data-bind="text: name"></span>
                                 </a>
                             </div>
                         </div>
                     </div>
                </div>
           </div>

         </div>
        </div>

        <!-- Geocode Panel -->
        <div class="geocode-container" data-bind="css : {'geocode-container-shim' : mapToolsExpanded, 'hide-geocoder': geocoderVisible}">
            <input id="select2Input" data-bind="
              select2v4Data: selectedGeocodeItems, select2v4: geocodeSelectSetup, placeholder: geocodePlaceholder" style="width: 100%"></input>
        </div>
        <!-- Map Tools Panel-->
        <!-- <div class="geocode-container" data-bind="css : {'geocode-container-shim' : mapToolsExpanded, 'hide-geocoder': geocoderVisible}">
            <input id="geocoderInput" data-bind="
              geocodeData: selectedItems, geocoder: selectSetup, placeholder: geocodePlaceholder" style="width: 100%"></input>
        </div> -->

        <div id="map-widget-container relative" class="">
            <div class="text-center map-widget-container" data-bind="css : {'map-widget-container-expanded' : mapToolsExpanded}">
                <a id="map-tools" href="" class="" style="display: inline;" data-bind="click: toggleMapTools"><i class="ion-ios-gear add-tooltip" data-bind="tooltip: { title: '{% trans "Map Controls" %}', placement: 'bottom' }"></i></a>
            </div>

            <div id="map-widget-toolbar" class="map-widget-toolbar relative" data-bind="fadeVisible: mapToolsExpanded, delay:200, fade:400">
              <ul class="map-widget-toolbar-list" style="">
                <li class="map-widget-toolbar-item text-center basemaps-map-tools" data-bind="click: function(){toggleMapControlPanels('basemaps')}, css : {'active': !mapControlPanels.basemaps()}">
                    <a id="" href="" class="map-widget-icon"><i class="ion-map add-tooltip" data-bind="tooltip: { title: '{% trans "Basemaps" %}', placement: 'bottom' }"></i></a>
                </li>
                <li id="btn-overlays" class="map-widget-toolbar-item text-center overlays-map-tools" data-bind="click: function(){toggleMapControlPanels('overlays')}, css : { 'active': !mapControlPanels.overlays()}">
                    <a id="overlays" href="" class="map-widget-icon"><i class="ion-navicon add-tooltip" data-bind="tooltip: { title: '{% trans "Overlays" %}', placement: 'bottom' }"></i></a>
                </li>
                <!-- ko ifnot: featureEditingDisabled -->
                <li class="map-widget-toolbar-item text-center drawing-map-tools" data-bind="click: function(){toggleMapControlPanels('maptools')}, css : {'active': !mapControlPanels.maptools() }">
                    <a id="" href="" class="map-widget-icon"><i class="ion-crop add-tooltip" data-bind="tooltip: { title: '{% trans "Map Tools" %}', placement: 'bottom' }"></i></a>
                </li>
                <!-- /ko -->
                <li class="map-widget-toolbar-item text-center legend-map-tools" data-bind="click: function(){toggleMapControlPanels('legend')}, css : {'active': !mapControlPanels.legend()}">
                    <a id="l" href="" class="map-widget-icon"><i class="ion-ios-list add-tooltip" data-bind="tooltip: { title: '{% trans "Legend" %}', placement: 'bottom' }"></i></a>
                </li>
                <li class="map-widget-toolbar-item text-center close-map-tools" data-bind="click: function(){toggleMapControlPanels('basemaps')}, css : {'map-widget-tool-expanded' : mapToolsExpanded}">
                    <a id="close-map-tools" href="#" class="map-widget-icon" data-bind="click: toggleMapTools"><i class="ion-ios-close add-tooltip" data-bind="tooltip: { title: '{% trans "Close" %}', placement: 'bottom' }"></i></a>
                </li>
              </ul>
            </div>

            <!-- Basemaps -->
            <div id="map-widget-basemaps" class="panel map-widget-panel" data-bind="fadeVisible: mapToolsExpanded, delay:200, fade:400, css : {'map-panel-inactive': mapControlPanels.basemaps}">
                <!-- Panel Title -->
                <div class="map-widget-panel-title">
                    <h4 class=""> Basemaps </h4>
                </div>

                <!-- ko foreach: { data: [$data], as: 'self' } -->

                <!-- ko foreach: basemaps -->
                <div class="map-widget-overlay-item relative" data-bind="click: self.selectBasemap">
                    <div class="map-overlay-vis-toogle text-center">
                        <!-- ko if: name === self.basemap()-->
                        <i class="ion-checkmark-circled"></i>
                        <!-- /ko -->
                        <!-- ko if: name !== self.basemap() -->
                        <i class="ion-checkmark-circled basemap-unselected"></i>
                        <!-- /ko -->
                    </div>
                    <div class="map-overlay-name">
                        <a id="" class="" href=""><span data-bind="text: name, css: {'basemap-unselected': name !== self.basemap()}"><span></a>
                    </div>
                </div>
                <!-- /ko -->
                <!-- /ko -->
            </div>
        </div>

        <!-- Overlays -->
        <div id="overlays-panel" class="panel map-widget-panel" data-bind="css: {'map-panel-inactive': mapControlPanels.overlays}">
            <!-- Panel Title -->
            <div class="map-widget-panel-title">
                <h4 class=""> Overlays
                  <i class="ion-ios-plus pull-right add-tooltip"
                    data-placement="left"
                    data-toggle="tooltip"
                    data-original-title="add overlay"
                    data-bind="click: toggleOverlaySelector"
                    ></i></h4>
            </div>

            <div data-bind="sortable: overlays">
                <div class="map-widget-overlay-item relative" data-bind="css:{'show-tools': showingTools, 'overlay-invisible':invisible}">
                    <div class="map-overlay-vis-toogle text-center" data-bind="css:{'overlay-invisible':invisible}, click: toggleOverlayVisibility">
                        <i data-bind="css: icon"></i>
                    </div>
                    <div class="map-overlay-name" data-bind="click: toggleOverlayVisibility">
                        <a class="" href=""><span data-bind="text:name"><span></a>
                    </div>
                    <div class="map-overlay-item-tools">
                        <a href="#" class="overlay-toggle" data-bind="click: toggleOverlayTools, css:{'overlay-invisible':invisible}">
                            <!-- ko if: showingTools() === false  -->
                            <i class="ion-arrow-left-b" data-bind="showingTools()"></i>
                            <!-- /ko -->
                            <!-- ko if: showingTools() !== false  -->
                            <i class="ion-arrow-down-b"></i>
                            <!-- /ko -->
                        </a>
                    </div>
                    <div class="map-overlay-item-tools-panel" data-bind="fadeVisible: showingTools, delay:300, fade: 200">

                        <!-- <div class="row"> -->

                        <!-- <div class="col-xs-8"> -->
                        <div class="overlay-slider">
                            <div data-bind="noUiSlider: {
                                start: opacity,
                                range: {
                                  'min': 0,
                                  'max': 100
                                },
                                connect: 'lower'
                            }"></div>
                        </div>
                        <!-- </div> -->

                        <!-- <div class="col-xs-4"> -->
                        <div class="overlay-tool-group">
                            <i class="ion-information-circled pull-right overlay-tool-icon add-tooltip" data-placement="left" data-toggle="tooltip" data-original-title="visible: 7-20"></i>
                            <a href="#" data-bind="click: function () { $parent.moveOverlay($data, 'up') }">
                                <i class="ion-ios-arrow-up pull-right overlay-tool-icon add-tooltip" data-placement="bottom" data-toggle="tooltip" data-original-title="move overlay up"></i>
                            </a>
                            <a href="#" data-bind="click: function () { $parent.moveOverlay($data, 'down') }">
                                <i class="ion-ios-arrow-down pull-right overlay-tool-icon add-tooltip" data-placement="bottom" data-toggle="tooltip" data-original-title="move overlay down"></i>
                            </a>
                        </div>
                        <!-- </div> -->

                        <!-- </div> -->

                    </div>
                </div>
            </div>

        </div>

        <!-- Map Tools -->
        <div id="maptools-panel" class="panel map-widget-panel" data-bind="css: {'map-panel-inactive': mapControlPanels.maptools}">
            <!-- Panel Title -->
            <div class="map-widget-panel-title">
                <h4 class=""> Map Tools </h4>
            </div>

            <!-- ko foreach: { data: [$data], as: 'self' } -->

            <!-- ko foreach: geometryTypes -->
            <div class="map-widget-overlay-item relative editing-tool" data-bind="click: function(){self.selectEditingTool(self, self.geometryTypeDetails[$data.id].name)}, css: {'map-draw-tools-active': self.geometryTypeDetails[$data.id].active}">
                <div class="map-overlay-vis-toogle text-center">
                    <i data-bind="css: self.geometryTypeDetails[$data.id].icon"></i>
                </div>
                <div class="map-overlay-name">
                    <a id="" class="" href=""><span data-bind='text: self.geometryTypeDetails[$data.id].name'><span></a>
                </div>
            </div>
            <!-- /ko -->
            <!-- /ko -->
            <div class="map-widget-overlay-item relative editing-tool" data-bind="click:selectEditingTool, css: {'map-draw-tools-active': drawMode() === 'simple_select' || drawMode() === 'direct_select'}">
                <div class="map-overlay-vis-toogle text-center">
                    <i class='ion-trash-a'></i>
                </div>
                <div class="map-overlay-name">
                    <a id="" class="" href=""><span>Delete<span></a>
                </div>
            </div>

        </div>

        <!-- Legend -->
        <div id="legend-panel" class="panel map-widget-panel" data-bind="css: {'map-panel-inactive': mapControlPanels.legend}">
            <!-- Panel Title -->
            <div class="map-widget-panel-title">
                <h4 class=""> Legend </h4>
            </div>
            <div data-bind="sortable: overlays">
                <div class="map-widget-overlay-item relative">
                    <div class="map-overlay-vis-toogle text-center">
                        <i data-bind="css: icon, style: {color: color}"></i>
                    </div>
                    <div class="map-overlay-name">
                        <a class="" href=""><span data-bind="text:name"><span></a>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Overlay Selector -->
    <div class="overlay-container" style="display: none;">
        <h3 class="panel-title card-main-title"> Overlays <i class="pull-right icon-xl ion ion-ios-close-empty"></i></h3>

        <!-- Overlay Listing -->
        <div id="report-image-grid" class="report-image-grid">


        </div>

    </div>
</div>
{% endblock form %} {% block report %}
<div>Map summary details possibly to go here...</div>
{% endblock report %} {% block config_form %}
<div class="control-label map-config-header">Map Properties</div>
<div class="panel-group accordion" id="accordion">
    <div class="panel">

        <!--Accordion title-->
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-parent="#accordion" data-toggle="collapse" href="#map-config-position" class="collapsed" aria-expanded="false">Position</a>
            </h4>
        </div>

        <!--Accordion content-->
        <div class="panel-collapse collapse" id="map-config-position" aria-expanded="false" style="height: 0px;">
            <div class="panel-body accordion-body">
                <div class="control-label">
                    {% trans "Map Center Longitude" %}
                </div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input type="number" id="" placeholder="{% trans " Longitude (x coordinate) " %}" class="form-control input-md widget-input" data-bind="value: centerX, valueUpdate: 'keyup'">
                </div>
                <div class="control-label">
                    {% trans "Map Center Latitude" %}
                </div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input type="number" id="" placeholder="{% trans " Longitude (x coordinate) " %}" class="form-control input-md widget-input" data-bind="value: centerY, valueUpdate: 'keyup'">
                </div>
                <div class="control-label">
                    {% trans "Pitch" %}
                </div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input type="number" id="" placeholder="{% trans " Pitch (Degrees) " %}" class="form-control input-md widget-input" data-bind="value: pitch, valueUpdate: 'keyup'">
                </div>
                <div class="control-label">
                    {% trans "Bearing" %}
                </div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input type="number" id="" placeholder="{% trans " Bearing (Degrees) " %}" class="form-control input-md widget-input" data-bind="value: bearing, valueUpdate: 'keyup'">
                </div>
            </div>
        </div>
    </div>
    <div class="panel">

        <!--Accordion title-->
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-parent="#accordion" data-toggle="collapse" href="#map-config-zoom" class="collapsed" aria-expanded="false">Zoom</a>
            </h4>
        </div>

        <!--Accordion content-->
        <div class="panel-collapse collapse" id="map-config-zoom" aria-expanded="false" style="height: 0px;">
            <div class="panel-body accordion-body">
                <div class="control-label">
                    {% trans "Default Zoom" %}
                </div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input type="number" min=1 max=20 id="" placeholder="{% trans " Zoom Level " %}" class="form-control input-md widget-input" data-bind="value: zoom, valueUpdate: 'keyup'">
                </div>
                <div class="control-label">
                    {% trans "Min Zoom" %}
                </div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input type="number" min=1 max=20 id="" placeholder="{% trans " Zoom Level " %}" class="form-control input-md widget-input" data-bind="value: minZoom, valueUpdate: 'keyup'">
                </div>
                <div class="control-label">
                    {% trans "Max Zoom" %}
                </div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input type="number" min=1 max=20 id="" placeholder="{% trans " Zoom Level " %}" class="form-control input-md widget-input" data-bind="value: maxZoom, valueUpdate: 'keyup'">
                </div>
            </div>
        </div>
    </div>
    <div class="panel">
        <!--Accordion title-->
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-parent="#accordion" data-toggle="collapse" href="#map-config-geocoder" aria-expanded="false" class="collapsed">Geocoder</a>
            </h4>
        </div>

        <!--Accordion content-->
        <div class="panel-collapse collapse" id="map-config-geocoder" aria-expanded="false" style="height: 0px;">
            <div class="panel-body accordion-body">
                <div class="control-label">
                    {% trans "Default Geocoder" %}
                </div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <select type="" id="" placeholder="{% trans " Geocoder " %}" data-bind="options:geocoderOptions, optionsText:'name', optionsValue:'id', event: {change: onGeocodeSelection}, value: geocoder, chosen: {width: '100%'}"></select>
                </div>
                <div class="control-label">
                    {% trans "Geocoder Placehoder" %}
                </div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input type="text" placeholder="{% trans " Geocoder Placehoder " %}" class="form-control input-md widget-input" data-bind="value: geocodePlaceholder, valueUpdate: 'keyup'">
                </div>
                <div class="control-label">
                    {% trans "Geocoder Availability" %}
                </div>
                <div class="col-xs-12 pad-no crud-widget-container">

                    <div class="toggle-container">
                        <span class="switch switch-small" data-bind="css: {'on': geocoderVisible}, click: toggleGeocoder"><small></small></span>
                        <p class="arches-toggle-sm">Toggle on to show a geocoder on the map</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel">
        <!--Accordion title-->
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-parent="#accordion" data-toggle="collapse" href="#map-config-resource-style" aria-expanded="false" class="collapsed">Resource Properties</a>
            </h4>
        </div>

        <!--Accordion content-->
        <div class="panel-collapse collapse" id="map-config-resource-style" aria-expanded="false" style="height: 0px;">
            <div class="panel-body accordion-body">
                <div class="control-label">{% trans "Color" %}</div>

                <div class="col-xs-12 pad-no crud-widget-container colorpicker-component">
                    <input placeholder="{% trans " Map Feature Color " %}" class="form-control input-lg widget-input" data-bind="colorPicker: {color: resourceColor, format:'rgba'}">
                </div>

                <div class="control-label">{% trans "Point Size" %}</div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input type="number" min="1" placeholder="{% trans " Map Feature Color " %}" class="form-control input-lg widget-input" data-bind="value: resourcePointSize, valueUpdate: 'keyup'">
                </div>

                <div class="control-label">{% trans "Line Width" %}</div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input type="number" min="1" placeholder="{% trans " Map Feature Color " %}" class="form-control input-lg widget-input" data-bind="value: resourceLineWidth, valueUpdate: 'keyup'">
                </div>

                <div class="control-label">{% trans "Available Geometry Types" %}</div>
                <div class="col-xs-12 pad-no crud-widget-container">
                    <input id="select2Input2" data-bind="
                      select2v4Data: geometryTypes,
                      select2v4: geomTypeSelectSetup" style="width: 100%">
                    </input>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock config_form %}
