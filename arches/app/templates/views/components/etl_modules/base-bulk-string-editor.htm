{% extends "views/components/etl_modules/base-import.htm" %}
{% load i18n %}

{% block task_details %}
<!-- ko ifnot: loading() -->
<div class="etl-module-component-container">
<div class="etl-module-body">
    <h3>
        <span data-bind="text:
            operation() == 'trim' ? $root.translations.bulkStringEditorTrim
            : operation() == 'case' ? $root.translations.bulkStringEditorChangeCase
            : operation() == 'replace' ? $root.translations.bulkStringEditorReplace
            : ''
        "></span>
    </h3>
    <div>
        <!-- ko if: operation() == 'case'-->
        <h4>
            <span data-bind="text: $root.translations.SelectEditOperation"></span>
        </h4>
        <select data-bind="
            value: selectedCaseOperation,
            options: caseOperations,
            optionsText: 'label',
            optionsValue: 'name',
            optionsCaption: $root.translations.select + '...',
            valueAllowUnset: true,
            chosen: {width: '500px'}"
        ></select>
        <!-- /ko -->
    </div>
    <div class="etl-module-component">
        <div data-bind="ifnot: ['trim', 'replace'].includes(operation())">
            <input type="checkbox" data-bind="checked: trim">
            <span data-bind="text: $root.translations.removeLeadingTrailingSpaces"></span>
        </div>
        <div>
            <h4>
                <span data-bind="text: $root.translations.useSearchUrl"></span>
            </h4>
            <textarea 
                style="min-height: 100px; width: 80%;"
                class="form-control textarea textarea-resizable" spellcheck="false" data-bind="textInput: searchUrl"
            ></textarea>
        </div>
        <div>
            <h4>
                <span data-bind="text: $root.translations.selectAResourceModel"></span>
            </h4>
            <select data-bind="
                value: selectedGraph,
                options: graphs,
                optionsText: 'name',
                optionsValue: 'graphid',
                optionsCaption: $root.translations.select + '...',
                valueAllowUnset: true,
                chosen: {width: '500px'}"
            ></select>    
        </div>
        <!-- ko if: nodes() -->
        <div>
            <h4>
                <span data-bind="text: $root.translations.selectANode"></span>
            </h4>
            <select data-bind="
                value: selectedNode,
                options: nodes,
                optionsText: 'label',
                optionsCaption: $root.translations.select + '...',
                optionsValue: 'nodeid',
                valueAllowUnset: true,
                chosen: {width: '500px'}"
            ></select>
        </div>
        <!-- /ko -->
        <div>
            <h4>
                <span data-bind="text: $root.translations.language"></span>
            </h4>
            <select data-bind="
                options: languages,
                optionsCaption: $root.translations.select + '...',
                optionsText: function(item){return item.name + ' (' + item.code + ')'},
                value: selectedLanguage,
                chosen: {width: '500px'}"
            ></select>
        </div>
        <div data-bind="if: operation() === 'replace'">
            <h4>
                <span data-bind="text: $root.translations.from"></span>
            </h4>
            <input type="text" style="width: 500px;" class="form-control" placeholder="Old Text" data-bind="textInput: oldText">
            <input type="checkbox" data-bind="checked: caseInsensitive">
            <span data-bind="text: $root.translations.caseInsensitive"></span>
            <h4>
                <span data-bind="text: $root.translations.to"></span>
            </h4>
            <input type="text" style="width: 500px;" class="form-control" placeholder="New Text" data-bind="textInput: newText">
        </div>
        <button style="margin: 25px 8px;" data-bind="click: preview, css: {disabled: !ready()}" class="btn btn-success">
            <span data-bind="text: $root.translations.preview"></span>
        </button>
    </div>
    <!-- ko if: showPreview-->
    <div>
        <div>
            <span data-bind="text: $root.translations.previewCountStats(numberOfTiles()>5?5:numberOfTiles(),numberOfTiles(),numberOfResources())"></span>
        </div>
        <table class="table table-striped csv-mapping-table">
            <thead>
                <tr>
                    <th style="border-bottom: 1px solid #ddd; vertical-align: top;">
                        <span data-bind="text: $root.translations.before"></span>
                    </th>
                    <th style="border-bottom: 1px solid #ddd; vertical-align: top;">
                        <span data-bind="text: $root.translations.after"></span>
                    </th>
                </tr>
            </thead>
            <tbody>
                <!-- ko foreach: { data: previewValue(), as: "row" } -->
                <!-- ko if: row[0] -->
                <tr>
                    <td style="vertical-align: text-top;" data-bind="html: row[0]"></td>
                    <td style="vertical-align: text-top;" data-bind="html: row[1]"></td>
                </tr>
                <!-- /ko -->
                <!-- /ko -->
            </tbody>
        </table>
    </div>
    <!-- /ko -->
</div>
<div class="tabbed-workflow-footer, etl-module-footer">
    <button style="margin-right: 8px;" data-bind="click: write, css: {disabled: !ready()}" class="btn btn-success">
        <span data-bind="text: $root.translations.start"></span>
    </button>
</div>
</div>
<!-- /ko -->
{% endblock task_details %}

{% block etl_status %}
<div>
    <h4>
        <span data-bind="text: $root.translations.bulkDataEditDetails"></span>
    </h4>
    <!-- ko if: load_details -->
    <!-- ko ifnot: loading() -->
    <table class="table table-striped" style="border:1px solid #ddd;">
        <tbody>
            <tr>
                <td style="min-width: 200px;"><span class="etl-loading-metadata-key" data-bind="text: $root.translations.resourceModelEditied"></span></td>
                <td><span class="etl-loading-metadata-value" data-bind="text: getGraphName(load_details.graph)"></span></td>      
            </tr>
            <tr>
                <td><span class="etl-loading-metadata-key" data-bind="text: $root.translations.fieldNameEdited"></span></td>
                <td><span class="etl-loading-metadata-value" data-bind="text: load_details.node"></span></td>      
            </tr>
            <tr>
                <td><span class="etl-loading-metadata-key" data-bind="text: $root.translations.searchUrl"></span></td>
                <td><span class="etl-loading-metadata-value" data-bind="text: load_details.search_url"></span></td>      
            </tr>
            <tr>
                <td><span class="etl-loading-metadata-key" data-bind="text: $root.translations.numberOfResourcesUpdated"></span></td>
                <td>
                    <span class="etl-loading-metadata-value"
                        data-bind="text: load_details.number_of_resources"
                    ></span>
                </td>      
            </tr>
            <tr>
                <td><span class="etl-loading-metadata-key" data-bind="text: $root.translations.editOperation"></span></td>
                <td>
                    <span class="etl-loading-metadata-value" data-bind="text: operationLabel[load_details.operation]"></span>
                </td>      
            </tr>
            <tr>
                <td><span class="etl-loading-metadata-key" data-bind="text: $root.translations.details"></span></td>
                <td>
                    <!-- ko if: ['replace', 'replace_i'].includes(load_details.operation) -->
                    <span class="etl-loading-metadata-value" data-bind="text: load_details.details.old_text"></span>
                    <i class="fa fa-long-arrow-right"></i>
                    <span class="etl-loading-metadata-value" data-bind="text: load_details.details.new_text"></span>
                    <!-- /ko -->
                </td>      
            </tr>
        </tbody>
    </table>
    <!-- /ko -->
    <!-- /ko -->
</div>
{% endblock etl_status %}
